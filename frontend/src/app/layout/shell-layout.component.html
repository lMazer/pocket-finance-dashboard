<a class="pf-skip-link" href="#pf-main-content">Pular para o conteudo</a>

<div class="shell">
  <aside class="shell__sidebar pf-card" [class.shell__sidebar--open]="isNavOpen()">
    <div class="brand">
      <div class="brand__mark" aria-hidden="true">PF</div>
      <div>
        <p class="brand__eyebrow">Pocket Finance</p>
        <h1 class="brand__title">Dashboard</h1>
      </div>
      <button class="sidebar-toggle sidebar-toggle--inside" type="button" (click)="closeNav()" aria-label="Fechar menu">
        ✕
      </button>
    </div>

    <nav class="nav" id="pf-mobile-nav" aria-label="Navegacao principal">
      @for (item of navItems; track item.path) {
        <a
          class="nav__link"
          [routerLink]="item.path"
          (click)="closeNav()"
          routerLinkActive="nav__link--active"
          [routerLinkActiveOptions]="{ exact: true }"
        >
          <span class="nav__main">
            <i class="nav__icon" [ngClass]="item.icon" aria-hidden="true"></i>
            <span>{{ item.label }}</span>
          </span>
          @if (item.badge) {
            <span class="nav__badge">{{ item.badge }}</span>
          }
        </a>
      }
    </nav>

    <div class="sidebar-foot">
      <p class="sidebar-foot__label">Ambiente</p>
      <p class="sidebar-foot__value pf-mono">Docker Dev</p>
      <p class="sidebar-foot__hint">Auto-reload ativo para frontend e backend.</p>
    </div>
  </aside>

  <div class="shell__content">
    @if (isBusy()) {
      <div class="shell__loading" aria-live="polite">
        <span class="shell__loading-bar"></span>
      </div>
    }

    <header class="shell__topbar pf-card">
      <div>
        <button
          class="sidebar-toggle"
          type="button"
          (click)="toggleNav()"
          [attr.aria-expanded]="isNavOpen()"
          aria-controls="pf-mobile-nav"
          [attr.aria-label]="isNavOpen() ? 'Fechar menu' : 'Abrir menu'"
        >
          ☰
        </button>
        <p class="shell__topbar-label">Workspace</p>
        <p class="shell__topbar-title">Controle Financeiro Pessoal</p>
        @if (user()) {
          <p class="shell__topbar-user">{{ user()!.fullName }} · {{ user()!.email }}</p>
        }
      </div>
      <div class="shell__topbar-actions">
        <a class="topbar-link" href="http://localhost:38080/swagger-ui/index.html" target="_blank" rel="noopener">
          <i class="ri-book-open-line" aria-hidden="true"></i>
          Swagger
        </a>
        <button class="topbar-link topbar-link--button" type="button" (click)="logout()" [disabled]="isLoggingOut()">
          <i class="ri-logout-box-r-line" aria-hidden="true"></i>
          {{ isLoggingOut() ? 'Saindo...' : 'Sair' }}
        </button>
      </div>
    </header>

    <main class="shell__main" id="pf-main-content" tabindex="-1">
      <router-outlet />
    </main>
  </div>
</div>

@if (isNavOpen()) {
  <button class="shell__backdrop" type="button" (click)="closeNav()" aria-label="Fechar menu"></button>
}

@if (toasts().length) {
  <aside class="toast-stack" aria-live="polite" aria-label="Notificacoes">
    @for (toast of toasts(); track toast.id) {
      <div class="toast" [class.toast--error]="toast.kind === 'error'" [class.toast--success]="toast.kind === 'success'">
        <p class="toast__text">{{ toast.message }}</p>
        <button type="button" class="toast__close" (click)="dismissToast(toast.id)" aria-label="Fechar notificacao">
          ×
        </button>
      </div>
    }
  </aside>
}
