<section class="pf-page">
  <header class="hero pf-card">
    <div>
      <p class="hero__eyebrow">Painel inicial</p>
      <h2 class="hero__title">Seu panorama financeiro em um so lugar</h2>
      <p class="hero__copy">Dados reais do mes atual carregados via API (transacoes + budgets).</p>
    </div>
    <div class="hero__status" [class.hero__status--error]="apiHealthState() === 'error'">
      <span class="hero__status-dot" [class.hero__status-dot--ok]="apiHealthState() === 'ok'"></span>
      <span>{{ apiHealthLabel() }}</span>
    </div>
  </header>

  @if (loadError()) {
    <app-state-error [message]="loadError()!" />
  }

  @if (isLoading()) {
    <app-state-loading message="Carregando dashboard..." />
  } @else {
    <section class="metrics">
      @for (item of highlights(); track item.label) {
        <article class="metric pf-card" [class.metric--positive]="item.tone === 'positive'" [class.metric--negative]="item.tone === 'negative'">
          <p class="metric__label">{{ item.label }}</p>
          <p class="metric__value">{{ item.value | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR' }}</p>
        </article>
      }
    </section>

    <section class="grid">
      <article class="panel pf-card">
        <div class="pf-card__header">
          <div>
            <h3 class="pf-card__title">Ultimas transacoes</h3>
            <p class="pf-card__subtitle">Top 5 do mes atual.</p>
          </div>
          <button class="pf-btn" type="button" (click)="reload()">Atualizar</button>
        </div>

        @if (!recentTransactions().length) {
          <app-state-empty message="Sem transacoes no mes atual." />
        } @else {
          <ul class="list">
            @for (tx of recentTransactions(); track tx.id) {
              <li class="list__item">
                <div>
                  <p class="list__title">{{ tx.description }}</p>
                  <p class="list__meta">{{ tx.categoryName }} Â· {{ tx.date | date: 'dd/MM' }}</p>
                </div>
                <p class="list__amount" [class.list__amount--positive]="tx.type === 'INCOME'">
                  {{ tx.amount | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR' }}
                </p>
              </li>
            }
          </ul>
        }
      </article>

      <article class="panel pf-card">
        <div class="pf-card__header">
          <div>
            <h3 class="pf-card__title">Metas do mes</h3>
            <p class="pf-card__subtitle">Resumo consolidado das categorias com budget.</p>
          </div>
        </div>

        @if (!budgetSummary()) {
          <app-state-empty message="Nenhuma meta cadastrada neste mes." />
        } @else {
          <div class="budget-summary">
            <p class="budget-summary__row">
              <span>Total de metas</span>
              <strong>{{ budgetSummary()!.total | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR' }}</strong>
            </p>
            <p class="budget-summary__row">
              <span>Despesas nas categorias com meta</span>
              <strong>{{ budgetSummary()!.spent | currency: 'BRL' : 'symbol' : '1.2-2' : 'pt-BR' }}</strong>
            </p>
            <div class="budget-summary__track" aria-hidden="true">
              <div class="budget-summary__fill" [style.width.%]="budgetSummary()!.coverage"></div>
            </div>
            <p class="budget-summary__caption">{{ budgetSummary()!.coverage | number: '1.0-0' }}% do limite utilizado</p>
          </div>
        }
      </article>
    </section>
  }
</section>
